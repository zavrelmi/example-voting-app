pipeline {

	agent {
		docker {
			image 'nodejs:8.9.0-slim'
			args '-v $HOME/.m2:/root/.m2'
		}
	}

	stages{
		stage("build"){
			when{ changeset "**/result/**"
			}
			steps{
				echo 'Compiling result app..'
				dir('result'){
				sh 'npm install'
				}
			}
		} 
		stage("test"){
			when{ changeset "**/result/**"
			}
			steps{
				echo 'Running Unit Tets on result app'
				dir('result'){
					sh 'npm install'
					sh 'npm test'
				}
			}
		} 
	
}
	post{
		always{
			echo 'Building multibranch pipeline for result is completed..'
		}					
	failure{
	slackSend (channel: "jenkins-testing", message: "Build Failed - ${env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)") }
	success{
	slackSend (channel: "jenkins-testing", message: "Build Succeeded - ${env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)") }
		
	}
}
